<!DOCTYPE html>
<html>
<head>
    <title>Debug Auth</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>üîç Supabase Auth Debug</h1>
    <div id="result"></div>
    
    <script>
        const supabaseUrl = 'https://ycxqxdhaxehspypqbnpi.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InljeHF4ZGhheGVoc3B5cHFibnBpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyMDMwMzEsImV4cCI6MjA2ODc3OTAzMX0.7RGVld6WOhNgeTA6xQc_U_eDXfMGzIshUlKV6j2Ru6g';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        async function debugAuth() {
            const resultDiv = document.getElementById('result');
            
            try {
                const { data: { user } } = await supabase.auth.getUser();
                
                if (user) {
                    const userInfo = {
                        email: user.email,
                        metadata: user.user_metadata,
                        role: user.user_metadata?.user_role,
                        confirmed: user.email_confirmed_at
                    };
                    
                    resultDiv.innerHTML = `
                        <h2>‚úÖ Bejelentkezett felhaszn√°l√≥:</h2>
                        <pre>${JSON.stringify(userInfo, null, 2)}</pre>
                        
                        <h3>üéØ √Åtir√°ny√≠t√°si teszt:</h3>
                        <p>Role: <strong>${userInfo.role}</strong></p>
                        <p>Kell lennie: <strong>school_admin</strong></p>
                        <p>√Åtir√°ny√≠t√°s: ${userInfo.role === 'school_admin' ? '‚úÖ admin-dashboard.html' : '‚ùå dashboard.html'}</p>
                        
                        <button onclick="testRedirect()">üöÄ Teszt √°tir√°ny√≠t√°s</button>
                    `;
                } else {
                    resultDiv.innerHTML = '<h2>‚ùå Nincs bejelentkezett felhaszn√°l√≥</h2>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<h2>üö® Hiba: ${error.message}</h2>`;
            }
        }
        
        async function testRedirect() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                const userRole = user.user_metadata?.user_role || 'student';
                console.log('üîç DEBUG userRole:', userRole);
                
                if (userRole === 'teacher') {
                    console.log('üéØ √Åtir√°ny√≠t√°s: teacher-dashboard.html');
                    window.location.href = '/teacher-dashboard.html';
                } else if (userRole === 'school_admin') {
                    console.log('üéØ √Åtir√°ny√≠t√°s: admin-dashboard.html');
                    window.location.href = '/admin-dashboard.html';
                } else {
                    console.log('üéØ √Åtir√°ny√≠t√°s: dashboard.html');
                    window.location.href = '/dashboard.html';
                }
            }
        }
        
        debugAuth();
    </script>
</body>
</html>